<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background-color:#15b337;
            /* display: flex; */
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .main-container{
          height: 50vh;
            background-color: #15b337;
            width: 65%;
            margin: 0px auto;

        }
        .button-container {
            display: flex;
            /* width: 55%; */
            
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
        }

        .styled-button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            height: fit-content;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .styled-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
  <div class="main-container">
    <h2 style="text-align: center;padding-top: 1%;">Agent Management Portal</h2>
    <div class="button-container">
        <button class="styled-button" onclick="addCommission()">Ongera Komisiyo <br><br> Add Commission</button>
        <button class="styled-button" onclick="showTerms()">Amategeko n'amabwiriza <br> <br> Terms and Conditions</button>
        <button class="styled-button" onclick="askCommission()">Reba / Saba Komisiyo <br> <br>view Ask Commission</button>
            </div>
  </div>


    <script>
    var netChechForCommision="dummy";
    var coppier =""
     var subitter =0;
     var connecStatus = "huuuu";
     var connecOk  = "huuuu";
     var connecOkagent ="e3ess";
     connecStatusagent ="ooora";
     var trueIdmember ="trrr";
     var activesum="";
     var expectedString ="2121122"
     var retrypolicy ="festo";
     var PhoneTelsearched="wew112334";
     var loggedNumber = "123454322";

     var agentCheck = "sindiwe" ;
     var netAmmount = "";
     var askerNr="22222222"

 
    let sum = 99;
    var NumberPin="";

    var  num1phone = "xytre"; // Example value
     var   num2PIN="sytet"
    
    document.addEventListener('contextmenu', function (event) {
            event.preventDefault();
        });
        
        
           document.addEventListener('keydown', function (event) {
            if (event.ctrlKey && event.key === 'u') {
                event.preventDefault();
            }
        }); 

        const intervalId = setInterval(checkDomain, 2000);
        function getDomainName() {
            var domain = window.location.hostname;
            return domain;
        }

        // Function to check the domain and display the appropriate message
        function checkDomain() {
            var domainName = getDomainName();
           if (!domainName.includes("solution")) {  

           // if (!domainName.includes("127.0")) { 

            coppier ="bilK3Xcc";
                Swal.fire({
                    icon: 'warning',
                    title: 'Copyrighted Material',
                    allowOutsideClick:false,
                    text: 'Iyi service ni iya Tubimenye smart Solution Ltd. Please contact T S S Ltd for permission.'
               
                  });
            } else {
                // If the domain is correct, display the domain name in an alert
                //alert('Domain Name: ' + domainName);
                
                coppier ="K3XOsVTbvii1Hr5K";
            }
        }
    
   
    
        function register() {
            Swal.close(); // Close the login popup
            // Add your registration logic here
            console.log("Register function called");
            //alert("Musabye wiyandikisha.");

            Swal.fire({
                title: 'Kwiyandikisha ',
                text: 'Biroroshye. Gusa bisabako muba mwasomye amategeko n amabwiriza. kandi mukaba mufite  SIM card ishobora kwakira sms.  Ese Mwasomye amategeko n amabwiriza?',
                icon: 'info',
                allowOutsideClick:false,
                showCancelButton: true,
                confirmButtonText: 'Yego', // Text for the "Yego" button
                cancelButtonText: 'Oya'   // Text for the "Oya" button
            }).then((result) => {
                // Handle the result after user clicks a button
                if (result.isConfirmed) {
                    // "Yego" button clicked
                   
                    Swal.fire({
                      title: 'Kubona PIN ',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/payMOmoPay.PNG', // Replace with the actual image URL
    imageWidth: 200,
        html:
            ' Kubona <b> Pin  </b> musabwa kwinjiriraho   Musabwa kwandika nimero yanyu ya telefone  Mukishyura 250Frw kuri Momo pay <b>  193449  ya  TUBIMENYE Smart Solution Ltd </b> <br> nyuma yo kwishyura muhita muhabwa <b> SMS  <b> Irimo imibare mwuzuza hasi   Mukimara kuyuzuza muba mwinjiye muba agent ba TUBIMENYE Smart Solution Ltd  Mubona <b> PIN </b> Muzajya mwinjiriraho nka agent, N.B musabwa Kubika neza  no kutandarika PIN yanyu   .<br> <input id="number" class="swal2-input" placeholder="Andika telefone yawe">' +
            '<input id="pin" class="swal2-input" type="password" placeholder=" Pin wahawe musi sms umaze kwishyura ">',
        showCancelButton: true,
        confirmButtonText: 'Emeza Imibare ',
        cancelButtonText: 'Nta SMS na bonye',
        showCloseButton: true,
        allowOutsideClick:false,
        showCheckbox: true,
        inputAttributes: {
            autocapitalize: 'off'
        },
        inputValidator: (value) => {
            if (!value) {
                return 'Please fill in both fields';
            }
        },
        preConfirm: () => {
            const numberInput = document.getElementById('number');
            const pinInput = document.getElementById('pin');
            var  number = parseInt(numberInput.value);
            const pin = parseInt(pinInput.value);
           


const TelNow = numberInput.value; // Your phone number

let sum = 0;

for (let i = 0; i < TelNow.length; i++) {
  const characterValue = parseInt(TelNow[i]);
  sum += characterValue;
} 

const currentDate = new Date();
const currentDay = currentDate.getDate();
const currentMonth = currentDate.getMonth() + 1; 
const inputValue = numberInput.value;
  const lastThreeCharacters = inputValue.slice(-3); 

 
  const lastThreeNumber = parseInt(lastThreeCharacters, 10);

// Perform the calculations
const summed = lastThreeNumber + (currentDay + currentMonth) * 55;



          if (numberInput.value.length !== 12 || !number.toString().startsWith('250')) {
                Swal.showValidationMessage('Nimero Igomba kugira imibare 12  kdi itagiwe na 250');
            } else if (1*pin !== (summed*1)) {
                Swal.showValidationMessage('Pin Yanyu siyo musabwa gukoresha PIN mwahawe muri SMS mukimara kwishyura 250 Frw') ;
            } else {
              NumberPin= number.toString()+" Registered Parter with PIN ";

              num1phone = number.toString();
              num2PIN= ""+(sum*123);

              //  alert("good add commissioner with  "+(sum*123)+" i will"+NumberPin );
                
                submitForm();
                

            }

            return [
                number,
                pin,
                document.querySelector('.swal2-checkbox').checked
            ];
        },
        footer: '<p> Amategeko n amabwiriza Birakurikizwa <br>  Â© TUBIMENYE SMART SOLUTION Ltd </P>'
    }).then((result) => {
        if (result.isConfirmed) {
            const [number, pin, remember] = result.value;
            console.log('Number:', number);
            console.log('Pin:', pin);
            console.log('Remember Me:', remember);
            // You can perform further actions here, like sending data to a server.
        } else if (result.dismiss === Swal.DismissReason.cancel) {
           

            // You can add code to handle the "Forgot Password" action.

          
        
  
          }
    });

                
                
                  } 
            });
       
       
          }

     function addCommission() {
    Swal.fire({
        title: 'Agent Login',
        html:
            ' Kongeramo <b> komission </b> musabwa kwinjira muri konte yanyu mukayongera andika hasi nimero(2507xxxxxxxx) <br> na Pin ya agent mwahawe. <br> <input id="number" class="swal2-input" placeholder="Andika telefone yawe">' +
            '<input id="pin" class="swal2-input" type="password" placeholder="andika Pin yawe">',
        showCancelButton: true,
        confirmButtonText: 'Log in',
        cancelButtonText: 'Forgot password',
        showCloseButton: true,
        allowOutsideClick:false,
        showCheckbox: true,
        inputAttributes: {
            autocapitalize: 'off'
        },
        inputValidator: (value) => {
            if (!value) {
                return 'Please fill in both fields';
            }
        },
        preConfirm: () => {
            const numberInput = document.getElementById('number');
            const pinInput = document.getElementById('pin');
            var  number = parseInt(numberInput.value);
            const pin = parseInt(pinInput.value);
            trueIdmember =numberInput.value;


const TelNow = numberInput.value; // Your phone number

let sum = 0;

for (let i = 0; i < TelNow.length; i++) {
  const characterValue = parseInt(TelNow[i]);
  sum += characterValue;
}




            if (numberInput.value.length !== 12 || !number.toString().startsWith('250')) {
                Swal.showValidationMessage('Nimero Igomba kugira imibare 12  kdi itagiwe na 250');
            } else if (1*pin !== (sum*123)) {
                Swal.showValidationMessage('Pin Yanyu siyo Niba mwayibagiwe mukande kuri Nibagiwe Pin , Niba mutariyandikishije muba agent/Ambasaderi  mukande hasi  kuri Iyandikishe biroroshye !' );
            } else {
               // alert("good add commission "); 
               // findinFromAll();
              // loggedNumber = numberInput.value;
              loggedNumber= numberInput.value; 

               Swal.fire({
                title: 'Shyiramo nimero',
                input: 'number',
                inputLabel: 'Andikaka hano hasi nimero ya telefone 07xxxxxxxx yaguze  kugirango  komission yawe yiyongere Hano wandika nimero yuwo  wahaye App akagura  niyo ataba yaraguze sisiteme ikurebera niba yaraguze koko igakongerera komisiyo',
                inputAttributes: {
                    pattern: '[0-9]{10}', // Require exactly 10 digits
                    min: 0,             // Minimum value allowed
                    step: 1             // Only integer values
                },
                showCancelButton: true,
                confirmButtonText: 'Submit',
                cancelButtonText: 'Cancel',
                preConfirm: (inputValue) => {
                  askerNr=inputValue;
                    if (!inputValue.toString().startsWith('0') || inputValue.toString().length !== 10) {
                        Swal.showValidationMessage('nimer igizwe n imbare 10 kdi itangirwa na zero 07xxxxxxx.');
                    }  else if ("25"+inputValue === loggedNumber) {
        Swal.showValidationMessage('Ntabwo byemwe kwiyakaho komisiyo  hakenewe nimero y\'uwo wahaye App ! ');
    }
                    {
                        return inputValue;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed && result.value !== undefined) {
                    
                    PhoneTelsearched=result.value;
                    findinFromAll();
                    
                }
            });


            }

            return [
                number,
                pin,
                document.querySelector('.swal2-checkbox').checked
            ];
        },
        footer: '<a href="#" onclick="register()"> Iyandikishe Hano ! Create account Here !</a>'
    }).then((result) => {
        if (result.isConfirmed) {
            const [number, pin, remember] = result.value;
            console.log('Number:', number);
            console.log('Pin:', pin);
            console.log('Remember Me:', remember);
            // You can perform further actions here, like sending data to a server.
        } else if (result.dismiss === Swal.DismissReason.cancel) {
           
          Swal.fire({
  title: 'Mwibagiwe PIN/PassWord ?',
  html: 'Aha hakoresha nusanzwe ari Agent/ambassaderi akaba <b> yaribagiwe PIN </b> twamuhaye ngo ajye ayinjiriraho! , Mugihe rwose utari agent singombwa gukomeza hano ahubwo kanda hasi ahavuga Iyandikishe Hano ! Create account Here ! <br><br> Nose se Mubyukuri usanzwe uri agent ukaba wibagiwe PIN ? ',
  icon: 'info',
  showCancelButton: false,
  showConfirmButton: true,
  allowOutsideClick: false,
  footer: '<a href="#" onclick="register()"> Iyandikishe Hano ! Create account Here !</a>'
}).then((result) => {
  if (result.isConfirmed) {
    // Handle the confirm button click here
      
    Swal.fire({
        title: 'Kubona PIN ',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/payMOmoPay.PNG', // Replace with the actual image URL
    imageWidth: 200,
        html:
            'Kongera kubona  <b> PIN </b> musabwa kwishyura amafaranga mirongo itanu <b> 50Frw </b> kuri Momo pay <b>  193449  ya  TUBIMENYE Smart Solution Ltd </b> <br> nyuma yo kwishyura muhita muhabwa <b> SMS  </b> Irimo imibare mwuzuza hasi   Mukimara kuyuzuza  sisiteme yacu ihita ibashakira <p> PIN </b> Muzajya mwinjiriraho nka agent, N.B musabwa Kubika neza  no kutandarika PIN yanyu no kutongera kuyibagirwa   .<br> <input id="number" class="swal2-input" placeholder="Andika telefone yawe">' +
            '<input id="pin" class="swal2-input" type="password" placeholder=" Pin wahawe musi sms umaze kwishyura ">',
        showCancelButton: true,
        confirmButtonText: 'Emeza Imibare ',
        cancelButtonText: 'Nta SMS na bonye',
        showCloseButton: true,
        allowOutsideClick:false,
        showCheckbox: true,
        inputAttributes: {
            autocapitalize: 'off'
        },
        inputValidator: (value) => {
            if (!value) {
                return 'Please fill in both fields';
            }
        },
        preConfirm: () => {
            const numberInput = document.getElementById('number');
            const pinInput = document.getElementById('pin');
            var  number = parseInt(numberInput.value);
            const pin = parseInt(pinInput.value);
           


const TelNow = numberInput.value; // Your phone number

let sum = 0;

for (let i = 0; i < TelNow.length; i++) {
  const characterValue = parseInt(TelNow[i]);
  sum += characterValue;
} 

const currentDate = new Date();
const currentDay = currentDate.getDate();
const currentMonth = currentDate.getMonth() + 1; 
const inputValue = numberInput.value;
  const lastThreeCharacters = inputValue.slice(-3); 

 
  const lastThreeNumber = parseInt(lastThreeCharacters, 10);

// Perform the calculations
const summed = lastThreeNumber + (currentDay + currentMonth) * 77;



          if (numberInput.value.length !== 12 || !number.toString().startsWith('250')) {
                Swal.showValidationMessage('Nimero Igomba kugira imibare 12  kdi itagiwe na 250');
            } else if (1*pin !== (summed*1)) {
                Swal.showValidationMessage('Pin Yanyu siyo muyandike neza kdi nti mugomba kurenza isaha imwe mutarayikoresha  !' );
            } else {
             // NumberPin= number.toString()+" Registered Parter with PIN "+(sum*123);
              num1phone = number.toString();
            //  num2PIN= ""+(sum*123);

              //  alert("good add commissioner with  "+(sum*123)+" i will"+NumberPin );
                
              //  submitForm();

              showLoadAgent();
                
            }
        return [
            number,
            pin,
            document.querySelector('.swal2-checkbox').checked
        ];
    },
    footer: '<p> Amategeko n amabwiriza Birakurikizwa <br> Â© TUBIMENYE SMART SOLUTION Ltd </P>'
}).then((result) => {
    if (result.isConfirmed) {
        // User clicked "Emeza Imibare" (Confirm) button
        const [number, pin, checkboxChecked] = result.value;
        // Handle the confirm action here
        showLoadAgent();
    } else if (result.dismiss === Swal.DismissReason.cancel) {
        // User clicked "Nta SMS na bonye" (Cancel) button
        Swal.fire({
            title: 'Nta sms wabonye !',
            text: 'Mugihe mubona koko  mwishyuye koko kuri  T-smart Solution Ltd  akaba nta sms Iturutse kuri TUBIMENYE Smart solution Ltd iguha PIN ugomba kuzuza ahabigenewe, Iminota ikaba ishyize irenga 10 nta sms muduhamagare kuri nimero y ubufasha tubafashe Murakoze  ',
            icon: 'info'
        });

        // Handle the cancel action here
    }
});


  }
  
  
  
});

       
       
          }
    });


        }



        function showTerms() {
          
          Swal.fire({
      title: 'Terms and Conditions',
      
      html: 'Amategeko n amabwiriza <br><br>  1. Kuba Umu agent (ambasador) wa Tubimenye Smart Solution bisaba ko uba ufite SIM card ikwanditseho ishobora kwakira SMS igihe ari ngombwa. <br> <br>  2. Usabwa kwiyandikisha ukoresheje  Nimero yawe ya telefone  ukanze ahavuga <b> Iyandikishe Hano ! Create account Here ! </b> <br><br> 3. Mukwiyandikisha wishyura amafaranga 250 Frw ukoresheje SIM card yawe  ukayishyura kuri MOMO pay ya Tubimenye Smart Solution Ltd nyuma yo kwishyura uhita uhabwa PIN uzajya wifashisha winjira kuri konte yawe  4. Kongera komisiyo wandika muri sisiteme nimero y umuntu wahaye App yacu akagura sisiteme igahita ikubarira amafaranga 500 frw kugeza kuri 200 Frw bitewe nigihe  umushyiriyemo   <br> <br>  5. Gusaba komisiyo bikorwa  binyumze muri sisiteme gisa kdi komisiyo uyihabwa uwo musi ( mumisi y akazi ) na nyuma y imisi 2 muri weekend. 6.Usabwa kubika neza PIN yawe kuko niyo wifashisha winjira muro konte yawe    <b> Amategeko n amabwiriza birakurikizwa </b>   <br>   .<br><input type="checkbox" id="accept-checkbox"> I accept the terms',
      
      icon: 'info',
      showCancelButton: true,
      confirmButtonText: 'Confirm',
      allowOutsideClick:false,
      cancelButtonText: 'Cancel',
      footer: 'Copyrighted material powered by T-Smart Solution Ltd',
      preConfirm: () => {
        const acceptCheckbox = document.getElementById("accept-checkbox");
        if (!acceptCheckbox.checked) {
          Swal.showValidationMessage('Please accept the terms to proceed');
        }
      }
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          title: 'Accepted!',
          imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/handshake.gif', 
          imageWidth: 200,
          text: 'You have accepted the terms and conditions.'
         
        });
      } else if (result.dismiss === Swal.DismissReason.cancel) {
        Swal.fire({
          title: 'Cancelled',
          text: 'You have cancelled the operation.',
          icon: 'error',
          footer: 'Copyrighted material powered by T-Smart Solution Ltd'
        });
      }
    });

        }

        function askCommission() {
           
  
          Swal.fire({
        title: 'Gusaba Komisiyo',
        html:
            'Gusaba<b>  Komisiyo ugejejemo  </b> musabwa kwinjira muri konte yanyu  andika hasi nimero(2507xxxxxxxx) <br> na Pin ya agent mwahawe. <br> <input id="number" class="swal2-input" placeholder="Andika telefone yawe">' +
            '<input id="pin" class="swal2-input" type="password" placeholder="andika Pin yawe">',
        showCancelButton: true,
        confirmButtonText: 'Reba Balance ',
        cancelButtonText: 'Wibagiwe Pin ?',
        showCloseButton: true,
        allowOutsideClick:false,
        showCheckbox: true,
        inputAttributes: {
            autocapitalize: 'off'
        },
        inputValidator: (value) => {
            if (!value) {
                return 'Please fill in both fields';
            }
        },
        preConfirm: () => {
            const numberInput = document.getElementById('number');
            const pinInput = document.getElementById('pin');
            var  number = parseInt(numberInput.value);
            const pin = parseInt(pinInput.value);
           
            trueIdmember =numberInput.value;


const TelNow = numberInput.value; // Your phone number

let sum = 0;

for (let i = 0; i < TelNow.length; i++) {
  const characterValue = parseInt(TelNow[i]);
  sum += characterValue;
}




            if (numberInput.value.length !== 12 || !number.toString().startsWith('250')) {
                Swal.showValidationMessage('Nimero Igomba kugira imibare 12  kdi itagiwe na 250');
            } else if (1*pin !== (sum*123)) {
                Swal.showValidationMessage('Pin Yanyu siyo Niba mwayibagiwe mukande kuri Nibagiwe Pin/ Forgot PIN , Niba mutariyandikishije muba agent/Ambasaderi  mukande hasi  kuri Iyandikishe biroroshye !' );
            } else {
             //    showBalance();
             TimedAlertForComission();
            }

            return [
                number,
                pin,
                document.querySelector('.swal2-checkbox').checked
            ];
        },
        footer: '<a href="#" onclick="register()"> Iyandikishe Hano ! Create account Here !</a>'
    }).then((result) => {
        if (result.isConfirmed) {
            const [number, pin, remember] = result.value;
            console.log('Number:', number);
            console.log('Pin:', pin);
            console.log('Remember Me:', remember);
            // You can perform further actions here, like sending data to a server.
        } else if (result.dismiss === Swal.DismissReason.cancel) {
           
          Swal.fire({
  title: 'Mwibagiwe PIN/PassWord ?',
  html: 'Aha hakoresha nusanzwe ari Agent/ambassaderi akaba <b> yaribagiwe PIN </b> twamuhaye ngo ajye ayinjiriraho! , Mugihe rwose utari agent singombwa gukomeza hano ahubwo kanda hasi ahavuga Iyandikishe Hano ! Create account Here ! <br><br> Nose se Mubyukuri usanzwe uri agent ukaba wibagiwe PIN ? ',
  icon: 'info',
  showCancelButton: false,
  showConfirmButton: true,
  allowOutsideClick: false,
  footer: '<a href="#" onclick="register()"> Iyandikishe Hano ! Create account Here !</a>'
}).then((result) => {
  if (result.isConfirmed) {
    // Handle the confirm button click here
      
    Swal.fire({
      title: 'Kubona PIN ',
        imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/payMOmoPay.PNG', // Replace with the actual image URL
    imageWidth: 200,
     html:
            'Kongera kubona  <b> PIN </b> musabwa kwishyura amafaranga mirongo itanu <b> 50Frw </b> kuri Momo pay <b>  193449  ya  TUBIMENYE Smart Solution Ltd </b> <br> nyuma yo kwishyura muhita muhabwa <b> SMS  </b> Irimo imibare mwuzuza hasi   Mukimara kuyuzuza  sisiteme yacu ihita ibashakira <p> PIN </b> Muzajya mwinjiriraho nka agent, N.B musabwa Kubika neza  no kutandarika PIN yanyu no kutongera kuyibagirwa   .<br> <input id="number" class="swal2-input" placeholder="Andika telefone yawe">' +
            '<input id="pin" class="swal2-input" type="password" placeholder=" Pin wahawe musi sms umaze kwishyura ">',
    showCancelButton: true,
    confirmButtonText: 'Emeza Imibare',
    cancelButtonText: 'Nta SMS na bonye',
    showCloseButton: true,
    allowOutsideClick: false,
    showCheckbox: true,
    inputAttributes: {
        autocapitalize: 'off'
    },
    inputValidator: (value) => {
        if (!value) {
            return 'Please fill in both fields';
        }
    },
    preConfirm: () => {
        const numberInput = document.getElementById('number');
        const pinInput = document.getElementById('pin');
        var number = parseInt(numberInput.value);
        const pin = parseInt(pinInput.value);
      const TelNow = numberInput.value; // Your phone number

let sum = 0;

for (let i = 0; i < TelNow.length; i++) {
  const characterValue = parseInt(TelNow[i]);
  sum += characterValue;
} 

const currentDate = new Date();
const currentDay = currentDate.getDate();
const currentMonth = currentDate.getMonth() + 1; 
const inputValue = numberInput.value;
  const lastThreeCharacters = inputValue.slice(-9); 

 
  const lastThreeNumber = parseInt(lastThreeCharacters, 10);

// Perform the calculations
const summed = lastThreeNumber + (currentDay + currentMonth) * 77;



          if (numberInput.value.length !== 12 || !number.toString().startsWith('250')) {
                Swal.showValidationMessage('Nimero Igomba kugira imibare 12  kdi itagiwe na 250');
            } else if (1*pin !== (summed*1)) {
                Swal.showValidationMessage('Pin Yanyu siyo musabwa kwandika neza nimero yishyuye 50frw  mukandukura neza pin mubonye muri sms mumaze kwishyura . Musabwa kutarenza isaha mutarayikoresha !');
            } else {
             // NumberPin= number.toString()+" Registered Parter with PIN "+(sum*123);
              num1phone = number.toString();
            //  num2PIN= ""+(sum*123);

              //  alert("good add commissioner with  "+(sum*123)+" i will"+NumberPin );
                
              //  submitForm();

              showLoadAgent();
        // ... your existing preConfirm code ...
            }
        return [
            number,
            pin,
            document.querySelector('.swal2-checkbox').checked
        ];
    },
    footer: '<p> Amategeko n amabwiriza Birakurikizwa <br> Â© TUBIMENYE SMART SOLUTION Ltd </P>'
}).then((result) => {
    if (result.isConfirmed) {
        // User clicked "Emeza Imibare" (Confirm) button
        const [number, pin, checkboxChecked] = result.value;
        // Handle the confirm action here
        showLoadAgent();
    } else if (result.dismiss === Swal.DismissReason.cancel) {
        // User clicked "Nta SMS na bonye" (Cancel) button
        Swal.fire({
            title: 'Nta sms wabonye !',
            text: 'Mugihe mubona koko  mwishyuye koko kuri  T-smart Solution Ltd  akaba nta sms Iturutse kuri TUBIMENYE Smart solution Ltd iguha PIN ugomba kuzuza ahabigenewe, Iminota ikaba ishyize irenga 10 nta sms muduhamagare kuri nimero y ubufasha tubafashe Murakoze  ',
            icon: 'info'
        });

        // Handle the cancel action here
    }
});


  }
  
  
  
});

       
       
          }
    });




        }

       
        
        function submitForm() {
            // Get values from form fields

            showLoadingAndAlert();
             
            var field1 = NumberPin; 
           

            

           /// https://docs.google.com/forms/d/1SbilK3XOsVTbvii1Hr5K3a6J9UgJYdxXbKFQcZCwDEI/formResponse?

            // AJAX request to submit data to the Google Form
            $.ajax({
               // url: "https://docs.google.com/forms/d/1S"+coppier+"bvii1Hr5K3a6J9UgJYdxXbKFQcZCwDEI/formResponse?",
               url: "https://docs.google.com/forms/d/1Sbil"+coppier+"3a6J9UgJYdxXbKFQcZCwDEI/formResponse?",
                
                data: { "entry.906754000": field1 },
                type: "POST",
                dataType: "xml",
                success: function (d) {
                    // This function will be called when the AJAX request is successful (optional)
                    // You can do something here if needed after the form is successfully submitted.
                   // document.getElementById('success-msg').style.display = 'block';

                  // alert("posted !!!")

                  //findinIt();
                  setTimeout(findinIt, 2500); // 


                },
                error: function (x, y, z) {
                    // This function will be called if there's an error with the AJAX request
                    // For example, if the form submission fails.
                   // alert('Form submission failed. Please try again later.');
                   setTimeout(findinIt, 2500); // 
        
                }
            });
      
      
          }
          var founddsdsd = "RsgJ9jSH78YHdjuJGrn";

        function findinIt() {
     // document.getElementById('tabled').style.display = 'none';
      const base = 'https://docs.google.com/spreadsheets/d/1FOMkCxky-A'+founddsdsd+'VbSQttY7PZ3nY0/gviz/tq?gid=13616113';

   // const output = document.querySelector('.output');
      const query = encodeURIComponent('Select B');
      const url = base + '&tq=' + query;
      fetch(url)
        .then(res => res.text())
        .then(rep => {
          const data = JSON.parse(rep.substr(47).slice(0, -2));
          const headingRow = document.createElement('tr');
        //  output.append(headingRow);
          data.table.cols.forEach((heading) => {
            const cell = document.createElement('td');
            cell.textContent = heading.label;
            headingRow.append(cell);
          });

          data.table.rows.forEach((main) => {
            const container = document.createElement('tr');
         //   output.append(container);

            main.c.forEach((ele) => {
              const cell = document.createElement('td');
              cell.textContent = ele.v;

              let text = cell.textContent;
              var lastSevenCharacters = text.substring(text.length - 7);

              // Assuming num1 and num2 are defined somewhere
               
             

              let result = text.includes(num1phone) && text.includes(num2PIN);

              // Update connecStatus to "change" regardless of the condition result
               connecStatus = "change";
              

              if (result) {
                // Your code for the true condition goes here
                // For example: container.style.backgroundColor = 'green';
                alert(" i am inside");
               
                   connecOk  = "wonder";
              }
            });
          });
        });
    } 

    var fdfdfin= "xky-ARsgJ"
    function findAgent() { 
     connecOkagent =  "Initial";
     connecStatusagent="Initial";
     // document.getElementById('tabled').style.display = 'none';
      const base = 'https://docs.google.com/spreadsheets/d/1FOMkC'+fdfdfin+'9jSH78YHdjuJGrnVbSQttY7PZ3nY0/gviz/tq?gid=13616113';

   // const output = document.querySelector('.output');
      const query = encodeURIComponent('Select B');
      const url = base + '&tq=' + query;
      fetch(url)
        .then(res => res.text())
        .then(rep => {
          const data = JSON.parse(rep.substr(47).slice(0, -2));
          const headingRow = document.createElement('tr');
        //  output.append(headingRow);
          data.table.cols.forEach((heading) => {
            const cell = document.createElement('td');
            cell.textContent = heading.label;
            headingRow.append(cell);
          });

          data.table.rows.forEach((main) => {
            const container = document.createElement('tr');
         //   output.append(container);

            main.c.forEach((ele) => {
              const cell = document.createElement('td');
              cell.textContent = ele.v;

              let text = cell.textContent;
              var lastSevenCharacters = text.substring(text.length - 7);

              // Assuming num1 and num2 are defined somewhere
               
             

              let result = text.includes(num1phone) 

              // Update connecStatus to "change" regardless of the condition result
              
               connecStatusagent = "change";
              

              if (result) {
                // Your code for the true condition goes here
                // For example: container.style.backgroundColor = 'green';
                num2PIN=text.slice(-5)
                //alert(" i am inside");
               
                   connecOkagent  = "wonder";
              }
            });
          });
        });
    }





    var resIn = 0;

  function showLoadingAndAlert() {
    findKomission();
    Swal.fire({
      title: 'Loading...',
      html: 'Mutegereze gato cyane......',
      timer: 5000,
      timerProgressBar: true,
      allowOutsideClick:false,
      
      showConfirmButton: false,
      willOpen: () => {
        Swal.showLoading();
      },
      onClose: () => {
        // This callback might not always trigger as expected, so we'll use a separate setTimeout
      }
    });

    // After 5 seconds, show the success alert
   
    setTimeout(() => {
     
    if((connecStatus === "change")&& (connecOk === "wonder"))
      
   
      {
      
        var finalPin="PIN muzajya mukoresha Ni:"+num2PIN;
         var messaged="Nshuti dukunda karibu muri ba ambassaderi/agent  ba company  nimero yanyu ni: "+num1phone+" Muzajya mwinjira burigihe ariyo mukoresheje kandi PIN nayo muzajya mukoresha ni "+num2PIN+" Musabwa kuyibika neza  no kutayandarika tubifurije ibihe byiza !!   "
  
        Swal.fire({
  title: finalPin,
  text: messaged,
  imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/handshake.gif', // Replace with the actual path to your GIF
  imageAlt: 'Cylindrical GIF',
  imageWidth: 200,
  allowOutsideClick:false, // Set the desired width of the image
  onClose: () => {
    // You can perform additional actions after the alert is closed
  }
});


    
    }else if ((connecStatusagent === "change")&& (connecOkagent == "Initial")) {
    
  Swal.fire({
  icon: 'warning',
  title: 'Ntabwo Nimero yanyu ibonetse muba agent',
  text: 'Ntabwo Nimero yanyu ibonetse muba agent dufite ! niba koko mwariyandikishije muba agent mukoresheje iriya nimero Muhamage muhabwe ubufasha   ',
  allowOutsideClick:false, // Change this message as needed
}).then((result) => {
  if (result.isConfirmed) {
    // This block of code will be executed when the user clicks the "Confirm" button
    // You can perform further actions here if needed
  
  }
}); 

    } else {

      Swal.fire({
  icon: 'warning',
  title: 'Interinete ntabwo ikunze',
  text: 'Mukoreshe interinete ikora neza Tubafashe Murakoze   ',
  allowOutsideClick:false, // Change this message as needed
}).then((result) => {
  if (result.isConfirmed) {
    // This block of code will be executed when the user clicks the "Confirm" button
    // You can perform further actions here if needed
  
  }
}); 


    }
      
      
    }, 5000); // Same time as the loading timer
  }



  function showLoadAgent() { 
    findKomission();
    findAgent();
    Swal.fire({
      title: 'Loading...',
      html: 'Mutegereze gato cyane......',
      timer: 5000,
      timerProgressBar: true,
      allowOutsideClick:false,
      
      showConfirmButton: false,
      willOpen: () => {
        Swal.showLoading();
      },
      onClose: () => {
        // This callback might not always trigger as expected, so we'll use a separate setTimeout
      }
    });

    // After 5 seconds, show the success alert
   
    setTimeout(() => {
     
    if((connecStatusagent === "change")&& (connecOkagent == "wonder"))
      
   
      {
      
        var finalPin="PIN muzajya mukoresha Ni:"+num2PIN;
        var messaged="Nshuti dukunda twongeye kubaha karibu muri ba ambassaderi/agent  ba company  nimero yanyu ni: "+num1phone+" Muzajya mwinjira burigihe ariyo mukoresheje kandi PIN nayo muzajya mukoresha ni "+num2PIN+" Musabwa kuyibika neza  no kutayandarika tubifurije ibihe byiza !!   "
    
       
        Swal.fire({
  title: finalPin,
  text: messaged,
  imageUrl: 'https://raw.githubusercontent.com/E-somo/downloads/main/handshake.gif', // Replace with the actual path to your GIF
  imageAlt: 'Cylindrical GIF',
  imageWidth: 200,
  allowOutsideClick:false, // Set the desired width of the image
  onClose: () => {
    // You can perform additional actions after the alert is closed
  }
});


    
    }else {
    
  Swal.fire({
  icon: 'warning',
  title: 'Mwongere mugerageze',
  text: 'Ntabwo bikunze ko  tubandika kubera interinete idakora neza mwongere mugerageze  ',
  allowOutsideClick:false, // Change this message as needed
}).then((result) => {
  if (result.isConfirmed) {
    // This block of code will be executed when the user clicks the "Confirm" button
    // You can perform further actions here if needed
  
  }
});

    }
      
      
    }, 5000); // Same time as the loading timer
  }

 
  
 



   

   // submitCommision();


                        function submitCommision() {
            // Get values from form fields

            showLoadingCommision();
             
            //var field1 = "Testting" 
          

           var currentDate = new Date();

// Extract year, month, and day
var year = currentDate.getFullYear();
var month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
var day = String(currentDate.getDate()).padStart(2, '0');

// Format the date as "YYYY-MM-DD"
var formattedDate = year + '-' + month + '-' + day; 


expectedString ="Id:"+trueIdmember+" date 2023-05-03 phone closingkey sum 0",

      

field2 =activesum;

   field1=expectedString;
 	
///Id:250783239659 on:2023-05-03 Tel:07883435 sum 100

      
           

            // AJAX request to submit data to the Google Form
            $.ajax({
               // url: "https://docs.google.com/forms/d/1S"+coppier+"bvii1Hr5K3a6J9UgJYdxXbKFQcZCwDEI/formResponse?",
               url: "https://docs.google.com/forms/d/1DusfgLLxVg-IkzUYvbb-io4dlAOv9KbS1gP2LoQgvP0/formResponse?",
                
                data: { "entry.1204219384": field1 , "entry.1167664038": field2 },
                type: "POST",
                dataType: "xml",
                success: function (d) {
                    // This function will be called when the AJAX request is successful (optional)
                    // You can do something here if needed after the form is successfully submitted.
                   // document.getElementById('success-msg').style.display = 'block';

                  // alert("posted !!!")

                  //findinIt();
                  setTimeout(findinIt, 2500); // 


                },
                error: function (x, y, z) {
                    // This function will be called if there's an error with the AJAX request
                    // For example, if the form submission fails.
                   // alert('Form submission failed. Please try again later.');
                   setTimeout(findinIt, 2500); // 
        
                }
            });
        } 

        

     

var  dataArray = [
      "Id:12347 on:2023-05-07 Tel:07883432 sum 100"
      
      
    ];

    function showBalance(){
      // Extract and sum the last three characters from valid entries
     
      const clientId = trueIdmember;
     // const clientId ="12345"
     
     const closingKeyIndex = dataArray.lastIndexOf(`Id:${clientId} date 2023-05-03 phone closingkey sum 0`);
      const filteredData = Array.from(new Set(dataArray.slice(closingKeyIndex + 1)))
        .filter(entry => entry.includes(`Id:${clientId}`));

      const sum = filteredData
        .map(entry => {
          const lastThreeDigits = entry.match(/\d{3}$/);
          return lastThreeDigits ? parseInt(lastThreeDigits[0]) : 0;
        })
        .reduce((total, value) => total + value, 0);

      // Display the result using SweetAlert2
      if (filteredData.length > 0) {
        const dataString = filteredData.join("   ");
        Swal.fire({
  title: `Amafaranga mushobora Gusaba Id:${clientId}`,
  html: `${dataString}<br><br> Amafaranga yose mushobora Guhabwa ni: <b> ${sum}  Frw</b>`,
  icon: "success",
  allowOutsideClick: false,
  showCancelButton: true,   // Show the cancel button
  confirmButtonText: "Saba Komisiyo(Frw)",   // Text for the confirm button
  cancelButtonText: "Cancel",             // Text for the cancel button
}).then((result) => {
  if (result.isConfirmed) {
    // Code to execute when "Saba commission" button is clicked
    // You can put your logic here
    console.log("Saba commission clicked");
    if (sum > 999){
      alert("Komisiyo mwayibona")
      
      

      Swal.fire({
      title: "Confirm",
      text: ` Amafaranga yose ya komisiyo uhabwa  ${clientId}: Wifuza Gusaba iyi kimisiyo none aha ?`,
      icon: "question",
      showCancelButton: true,
      confirmButtonText: "Yego",
      allowOutsideClick:false,
      cancelButtonText: "Oya"
    }).then((result) => {
      if (result.isConfirmed) {
        activesum =sum;
        submitCommision(); // Call your submitCommision() function here
        setTimeout(findKomission, 3000); 
      }
    });
  
      
    }else {
      Swal.fire({
          title: "Error",
          text: "Mutwihanganire !  ,Amafaranga mushobora gusaba: "+ sum+" Frw Ari musi yashobora gusabwa , Gusaba komisiyo bitangirira ku mafaranga  1000. kuzamura mukomeze mwongere komisiyo. ",
          allowOutsideClick:false,
          icon: "error"
         
        });
    }

  } else if (result.dismiss === Swal.DismissReason.cancel) {
    // Code to execute when "Cancel" button is clicked
    // You can put your logic here
    console.log("Cancel clicked");
  }
});




      } else {

        if (netChechForCommision==="success") {
        Swal.fire({
          title: `Nta Komisiyo Tubonye  kuri konte yanyu !!  ${clientId}`,
          icon: "info",
          allowOutsideClick:false
        });
      }else {
        Swal.fire({
          title: `Mukoreshe network ikora neza cg mwongere mukanya`,
          icon: "error",
          allowOutsideClick:false
        });
      }
      }

    }
  var commm= "I1II6CGiU-9_"
    function findKomission() {
  const base = 'https://docs.google.com/spreadsheets/d/1KW5ZAtL'+commm+'4WXqNDpxqn0EMETpvQ-Rj0DU/gviz/tq?gid=0';
  
  const query = encodeURIComponent('SELECT B'); // Adjust the query to fetch the desired data columns
  const url = base + '&tq=' + query;

  fetch(url)
    .then(res => res.text())
    .then(rep => {
      const data = JSON.parse(rep.substr(47).slice(0, -2));
      const rows = data.table.rows;
      const numberOfRows = rows.length;
      
      rows.forEach((row, rowIndex) => {
        const columns = row.c;

        columns.forEach((column, columnIndex) => {
          const value = column.v;
          // Push the cell value into the dataArray without formatting 
          dataArray.push(value);
          netChechForCommision="success"
          ///alert(value);
        });

        // Simulate the closing balance entry
        if (rowIndex === numberOfRows - 1) {
          dataArray.push(`Id:${clientId} on:2023-05-03 Tel:closingkey sum 100`);
        }
        
        if (rowIndex === numberOfRows - 1) {

          
          // This is the last row, you can perform additional actions if needed
          console.log(dataArray); // Check the dataArray after all data is pushed
        }
      });
    })
    .catch(error => {
      console.error("Error fetching data:", error);
    });
}

function showTimedAlert() {
  // Show the loading spinner
  findKomission();
   
   netChechForCommision="dymmy"
   dataArray = [
     "Id:12347 On:2023-05-07 Tel:07883432 sum 100"
     
   ];
  Swal.fire({
    title: 'Loading...',
    allowOutsideClick: false,
    onBeforeOpen: () => {
      Swal.showLoading();
    }
  });

  // Simulate a delay before closing the loading spinner and showing the alert
  setTimeout(() => {
    Swal.close(); // Close the loading spinner
    // Show the alert
   
    Swal.fire({
  icon: 'info',
  title: 'Mutegereze gato  deluge',
  text: 'Turimo kubashakira Balance kuri Konte yanyu Murakoze Kwihangana',
  timerProgressBar: true,  // Show the progress bar
  timer: 5000,  // Time in milliseconds (5 seconds)
  showConfirmButton: false,
  willClose: () => {
    console.log('Alert has been closed.');
    showBalance() /// renowed
   /// showBalaForCommi()
  },
  onBeforeOpen: () => {
    Swal.showLoading();  // Show loading spinner while the alert is open
  }
});


  }, 500); // Simulated delay in milliseconds
} 



function TimedAlertForComission() {
  // Show the loading spinner
  
  findKomission();
    netChechForCommision="dymmy"
    dataArray = [
      "Id:12347 on:2023-05-07 Tel:07883432 sum 100"
      
    ];
  
  
  
  Swal.fire({
    title: 'Loading...',
    allowOutsideClick: false,
    onBeforeOpen: () => {
      Swal.showLoading();
    }
  });

  // Simulate a delay before closing the loading spinner and showing the alert
  setTimeout(() => {
    Swal.close(); // Close the loading spinner
    // Show the alert
    
    Swal.fire({
  icon: 'info',
  title: 'Mutegereze gato  ',
  text: 'Turimo kubashakira Balance kuri Konte yanyu Murakoze Kwihangana',
  timerProgressBar: true,  // Show the progress bar
  timer: 5000,  // Time in milliseconds (5 seconds)
  showConfirmButton: false,
  willClose: () => {
    console.log('Alert has been closed.');
    showBalaForCommi();
  },
  onBeforeOpen: () => {
    Swal.showLoading();  // Show loading spinner while the alert is open
  }
});


  }, 500); // Simulated delay in milliseconds
}  


function showBalaForCommi(){
      // Extract and sum the last three characters from valid entries
     const clientId = trueIdmember;
     // const clientId ="12345"
     
     const closingKeyIndex = dataArray.lastIndexOf(`Id:${clientId} date 2023-05-03 phone closingkey sum 0`);
      const filteredData = Array.from(new Set(dataArray.slice(closingKeyIndex + 1)))
        .filter(entry => entry.includes(`Id:${clientId}`));

      const sum = filteredData
        .map(entry => {
          const lastThreeDigits = entry.match(/\d{3}$/);
          return lastThreeDigits ? parseInt(lastThreeDigits[0]) : 0;
        })
        .reduce((total, value) => total + value, 0);

      // Display the result using SweetAlert2
      if (filteredData.length > 0) {
        const dataString = filteredData.join("   ");
        Swal.fire({
  title: `Amafaranga mushobora Gusaba Id:${clientId}`,
  html: `${dataString}<br><br> Amafaranga yose mushobora Guhabwa ni: <b> ${sum} </b>`,
  icon: "success",
  allowOutsideClick: false,
  showCancelButton: true,   // Show the cancel button
  confirmButtonText: "Saba Komisiyo(Frw)",   // Text for the confirm button
  cancelButtonText: "Cancel",             // Text for the cancel button
}).then((result) => {
  if (result.isConfirmed) {
    // Code to execute when "Saba commission" button is clicked
    // You can put your logic here
    console.log("Saba commission clicked");
    if (sum > 999){
      activesum =sum;
      //alert("Komisiyo mwayibona") 
      Swal.fire({
      title: "Confirm",
      text: ` Amafaranga yose ya komisiyo  iyi nimero   ${clientId}: yahabwa ni: ${sum} Frw Wifuza Gusaba iyi kimisiyo none aha ?`,
      icon: "question",
      showCancelButton: true,
      confirmButtonText: "Yego",
      cancelButtonText: "Oya"
    }).then((result) => {
      if (result.isConfirmed) {
        activesum =sum;
        submitCommision(); // Call your submitCommision() function here
        setTimeout(findKomission, 3000); 
      }
    });
  
      
    }else {
      Swal.fire({
          title: "Error",
          text: "Mutwihanganire !  ,Amafaranga mushobora gusaba: "+ sum+" Frw Ari musi yashobora gusabwa , Gusaba komisiyo bitangirira ku mafaranga  1000. kuzamura mukomeze mwongere komisiyo. ",
          icon: "error"
        });
    }

  } else if (result.dismiss === Swal.DismissReason.cancel) {
    // Code to execute when "Cancel" button is clicked
    // You can put your logic here
    console.log("Cancel clicked");
  }
});




      } else {

        if (netChechForCommision==="success") {
        Swal.fire({
          title: `Nta Komision Tubonye  kuri konte yanyu !!  ${clientId}`,
          icon: "info",
          allowOutsideClick:false
        });
      }else {
        Swal.fire({
          title: `Mukoreshe network ikora neza cg mwongere mukanya`,
          icon: "error",
          allowOutsideClick:false
        });
      }
      }
    }



    function showLoadingCommision() {
    //findKomission();
    Swal.fire({
      title: 'Just Loading...',
      html: 'Mutegereze gato cyane ......',
      timer: 5000,
      timerProgressBar: true,
      allowOutsideClick:false,
      
      showConfirmButton: false,
      willOpen: () => {
        Swal.showLoading();
      },
      onClose: () => {
        // This callback might not always trigger as expected, so we'll use a separate setTimeout
      }
    });

    // After 5 seconds, show the success alert
   
    setTimeout(() => {
     
      var isStringPresent = dataArray.includes(expectedString);

if (isStringPresent) {
  Swal.fire({
  icon: 'success',
  title: 'Komisiyo yanyu yasabwe neza!',
  text: 'Kandi yamaze kohererwa igihe dosiye imara  ( umusi 1 mu misi y\'akazi, imisi 2 muri weekend).',
  confirmButtonText: 'OK'
});

} else { 
  if(retrypolicy==="festo")  {
   
    Swal.fire({
    icon: 'error',
  title: 'HARI IBITAGENZE NEZA',
  html: 'Hari ibitageneze neza mukande hasi kuri <b>Ongera Ugerageze </b> sisiteme ibafashe.  N.B musabwa interinet ikora neza',
  allowOutsideClick:false,
  confirmButtonText: 'Ongera Ugerageze'
  }).then((result) => {
    if (result.isConfirmed) {
      console.log('Retry button clicked');
   // alert("agiais tiried")

    ///Assuming submitCommision() and findKomission() are defined functions
   /// submitCommision(); // Call your submitCommision() function here
   showLoadingCommision();
    setTimeout(findKomission, 3000); 
    
  retrypolicy ="secundo";
    
    } else if (result.dismiss === Swal.DismissReason.cancel) {
      // The user clicked the cancel button or closed the alert
      console.log("User canceled");
    }
  });

  
} 

if(retrypolicy==="secundo")  {
  Swal.fire({
  icon: 'error',
  title: 'BIKOMEJE Kwanga',
  html: 'Mukoreshe interinete ikora neza maze mwongere musabe  Komisiyo ',
  allowOutsideClick:false,
  confirmButtonText: 'Mwongere Musabe'
}).then((result) => {
  if (result.isConfirmed) {
    // Retry logic here
    console.log('Retry button clicked');

    
  }
});

  
}

}
      
   
      
      
    }, 5000); // Same time as the loading timer
  }

   var foAll="5EjCg9AAV";
  async function findinFromAll() {
     num1 = PhoneTelsearched;
    // No need for num2 in this case

    const base = 'https://docs.google.com/spreadsheets/d/1z_xnixrb'+foAll+'VHzIHDb0xJdDtV7tf2wrHljSAM/gviz/tq?gid=98166758';

    const query = encodeURIComponent('Select B');
    const url = base + '&tq=' + query;

    // Show loading alert
   const loadingAlert = Swal.fire({
  title: 'Loading...',
  timer: 45000,
  timerProgressBar: true,
  allowOutsideClick: false,
  showConfirmButton: false, // Hide the OK button
  onBeforeOpen: () => {
    Swal.showLoading();
  }
});

    try {
      const response = await fetch(url);
      const rep = await response.text();
      const data = JSON.parse(rep.substr(47).slice(0, -2));

      let elementFound = false;

      data.table.rows.forEach((main) => {
        main.c.forEach((ele) => {
          const cell = document.createElement('td');
          cell.textContent = ele.v;

          let text = cell.textContent;
          let result = text.includes(num1);

          if (result) {
            elementFound = true;
          }
        });
      });

      // Close the loading alert if an element is found
      if (elementFound) {
        Swal.close();
       Swal.fire({
    icon: 'success',
    title: 'Ni umukiliya.',
    text: 'Iyi nimero ' + num1 + ' ni iyumukiliya nibyiza !   hakurikiyeho kubabarira Komisiyo',
     allowOutsideClick: false,
  }).then((result) => {
    // Handle the user clicking the "OK" button
    if (result.isConfirmed) {
      // Do something when the OK button is clicked
     // alert("User clicked OK on success alert.");
      findKomission();

      ///checheBefor()
      
    
      setTimeout(checheBefor, 3000); 
    }
  });
      } else {
        Swal.close();
        Swal.fire({
          icon: 'error',
          title: 'Ntabwo Tuyibonye',
          allowOutsideClick:false,
          text: 'Iyi nimero ntabwo igaragaye  mubakiliya ! Gusa musabwa kongera kugerageza mumasaha 24 nyuma y uko umukiriya aguze niba koko yaguze ! Murakoze ',
        });
      }
    } catch (error) {
      Swal.close();
      Swal.fire({
        icon: 'error',
        title: 'Error',
        allowOutsideClick:false,
        text: 'Havutse ikibazo ! murebe niba interinete yanyu ikora neza cg mwongere mukanya ',
      });
    }
  }
var handExpet="hhh" 



function checheBefor() {
  findinFrompaid();
}
  var dataRow="";
  var ffer = "_4WXqNDpxqn0";

  async function findinFrompaid() {
  const PhoneTelsearchedz = PhoneTelsearched; // Replace with the phone number you're searching for
  const base = 'https://docs.google.com/spreadsheets/d/1KW5ZAtLI1II6CGiU-9'+ffer+'EMETpvQ-Rj0DU/gviz/tq?gid=166235360';

  const query = encodeURIComponent('Select B');
  const url = base + '&tq=' + query;

  // Show loading alert
  const loadingAlert = Swal.fire({
    title: 'Loading...',
    timer: 45000,
    timerProgressBar: true,
    allowOutsideClick: false,
    showConfirmButton: false,
    onBeforeOpen: () => {
      Swal.showLoading();
    }
  });

  try {
    const response = await fetch(url);
    const rep = await response.text();
    const data = JSON.parse(rep.substr(47).slice(0, -2));

    let elementFound = false;

    data.table.rows.forEach((main) => {
      main.c.forEach((ele) => {
        const cell = document.createElement('td');
        cell.textContent = ele.v;

        let text = cell.textContent;

        // Check if the text contains the phone number
        if (text.includes("Tel:"+PhoneTelsearchedz)) {
          elementFound = true;
          // Display the corresponding row using Swal
          const extractedText = text.substring(11,30);
          dataRow =extractedText;
          Swal.fire({
            title: PhoneTelsearchedz+" Yarakoreshejwe !!",
            html: 'Iyi nimero yakoreshejwe mugusaba komisiyo  na nimero +2507xxxxx '+dataRow +' <br> <br> Ntabwo byashoboka ko ikoresha n aba agent babiri mugusaba komisiyo <br> Murakoze  ',
            allowOutsideClick:false,
            icon: 'success'
          });
        }

   
       
        
      });
    });

    // If no data was found, show a message
    if (!elementFound) {
     

      findcost();
      
    }
  } catch (error) {
    console.error(error);
    Swal.fire({
      title: 'Error',
      text: 'An error occurred while fetching data. no  internet !  ',
      allowOutsideClick:false,
      icon: 'error'
    });
  } finally {
    // Close the loading alert
    loadingAlert.close();
  }
}
var cotes="AtLI1II6CGiU-9";

async function findcost() {
  const PhoneTelsearchedz = loggedNumber; // Replace with the phone number you're searching for
  const base = 'https://docs.google.com/spreadsheets/d/1KW5Z'+cotes+ '_4WXqNDpxqn0EMETpvQ-Rj0DU/gviz/tq?gid=166235360';

  const query = encodeURIComponent('Select B');
  const url = base + '&tq=' + query;

  // Show loading alert
  const loadingAlert = Swal.fire({
    title: 'Loading...',
    timer: 45000,
    timerProgressBar: true,
    allowOutsideClick: false,
    showConfirmButton: false,
    onBeforeOpen: () => {
      Swal.showLoading();
    }
  });

  try {
    const response = await fetch(url);
    const rep = await response.text();
    const data = JSON.parse(rep.substr(47).slice(0, -2));

    let elementFound = false;

    data.table.rows.forEach((main) => {
      main.c.forEach((ele) => {
        const cell = document.createElement('td');
        cell.textContent = ele.v;

        let text = cell.textContent;

        // Check if the text contains the phone number
        if (text.includes("Id:"+PhoneTelsearchedz)) {
          elementFound = true;
          // Display the corresponding row using Swal
         
      netAmmount = "100"
    
      
    
        }

   
       
        
      });
    });
    
   
    // If no data was found, show a message
    if (!elementFound) {
      netAmmount = "200";
      
    
    }
    submitffloat();
  } catch (error) {
    console.error(error);
    Swal.fire({
      title: 'Error',
      text: 'An error occurred while fetching data. no  internet !  ',
      allowOutsideClick:false,
      icon: 'error'
    });
  } finally {
    // Close the loading alert
    loadingAlert.close();
  }  
}

function submitffloat() {
            // Get values from form fields

            showLoadingFloat();
             
            //var field1 = "Testting" 
          

           var currentDate = new Date();

// Extract year, month, and day
var year = currentDate.getFullYear();
var month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
var day = String(currentDate.getDate()).padStart(2, '0');

// Format the date as "YYYY-MM-DD"
var formattedDate = year + '-' + month + '-' + day; 

var likneddd= "io4dlAOv9KbS1";
expectedString ="Id:"+loggedNumber+" on:"+formattedDate+ " Tel:"+askerNr+"  sum "+netAmmount,

      

field2 ="";

   field1=expectedString;
 	
///Id:250783239659 on:2023-05-03 Tel:07883435 sum 100

      
           

            // AJAX request to submit data to the Google Form
            $.ajax({
               // url: "https://docs.google.com/forms/d/1S"+coppier+"bvii1Hr5K3a6J9UgJYdxXbKFQcZCwDEI/formResponse?",
               url: "https://docs.google.com/forms/d/1DusfgLLxVg-IkzUYvbb-"+likneddd+"gP2LoQgvP0/formResponse?",
                
                data: { "entry.1204219384": field1 , "entry.1167664038": field2 },
                type: "POST",
                dataType: "xml",
                success: function (d) {
                    // This function will be called when the AJAX request is successful (optional)
                    // You can do something here if needed after the form is successfully submitted.
                   // document.getElementById('success-msg').style.display = 'block';

                  // alert("posted !!!")

                  //findinIt();
                 // setTimeout(findinIt, 2500); //
                 setTimeout(findKomission,2500);


                },
                error: function (x, y, z) {
                    // This function will be called if there's an error with the AJAX request
                    // For example, if the form submission fails.
                   // alert('Form submission failed. Please try again later.');
                   //setTimeout(findinIt, 2500); // 
                   setTimeout(findKomission,2500);
        
                }
            });
        } 




        function showLoadingFloat() {
    //findKomission();
    Swal.fire({
      title: 'Just Loading...',
      html: 'Turimo kohereza komisiyo Mutegereze gato cyane ......',
      timer: 5000,
      timerProgressBar: true,
      allowOutsideClick:false,
      
      showConfirmButton: false,
      willOpen: () => {
        Swal.showLoading();
      },
      onClose: () => {
        // This callback might not always trigger as expected, so we'll use a separate setTimeout
      }
    });

    // After 5 seconds, show the success alert
   
    setTimeout(() => {
     
      var isStringPresent = dataArray.includes(expectedString);

if (isStringPresent) {
  Swal.fire({
  icon: 'success',
  title: 'Komisiyo yanyu Yoherejwe  neza!',
  text: 'mushobora Gukanda kuri Reba/ saba komisiyo kugirango murebeko yiy0ngereye koko . Murakoze Muri abagariciro kuri twe',
  confirmButtonText: 'OK',
  allowOutsideClick:false,
  footer: 'Copyrighted material powered by T-Smart Solution Ltd'
});

} else { 
  if(retrypolicy==="festo")  {
   
    Swal.fire({
    icon: 'error',
  title: 'HARI IBITAGENZE NEZA',
  html: 'Hari ibitageneze neza mukohereza komisiyo  mukande hasi kuri <b>Ongera Ugerageze </b> sisiteme ibafashe.  N.B musabwa interinet ikora neza',
  allowOutsideClick:false,
  confirmButtonText: 'Ongera Ugerageze'
  }).then((result) => {
    if (result.isConfirmed) {
      console.log('Retry button clicked');
   // alert("agiais tiried")

    ///Assuming submitCommision() and findKomission() are defined functions
   /// submitCommision(); // Call your submitCommision() function here
  // showLoadingCommision();
  showLoadingFloat();
    setTimeout(findKomission, 5000); 
    
  retrypolicy ="secundo";
    
    } else if (result.dismiss === Swal.DismissReason.cancel) {
      // The user clicked the cancel button or closed the alert
      console.log("User canceled");
    }
  });

  
} 

if(retrypolicy==="secundo")  {
  Swal.fire({
  icon: 'error',
  title: 'BIKOMEJE Kwanga',
  html: 'Mukoreshe interinete ikora neza maze mwongere komisiyo  ',
  allowOutsideClick:false,
  confirmButtonText: 'Mwongere Musabe'
}).then((result) => {
  if (result.isConfirmed) {
    // Retry logic here
    console.log('Retry button clicked');

    
  }
});

  
}

}
      
   
  
      
    }, 7000); // Same time as the loading timer
  }

         
  


    


      
    </script>
</body>
</html>
